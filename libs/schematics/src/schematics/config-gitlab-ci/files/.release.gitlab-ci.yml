variables:
  CI_CONFIG_VERSION: 'v4.20.7'

include:
  - project: 'rxap/gitlab-ci'
    ref: v4.20.7
    file: '/templates/firebase/deploy.yml'
  - project: 'rxap/gitlab-ci'
    ref: v4.20.7
    file: '/templates/nrwl/run.yml'

stages:
  - build
  - deploy

pwa:build:production:
  tags:
    - build
  extends: .run
  before_script:
    - yarn --prefer-offline
  variables:
    TARGET: "pwa:build:production"
    ADDITIONAL_TARGET_LIST: "pwa:build-info"
    GIT_SUBMODULE_STRATEGY: recursive
  cache:
    key:
      files:
        - yarn.lock
    paths:
      - node_modules/
    policy: pull

pwa:deploy:
  tags:
    - script
  extends: .hosting:channel:deploy
  needs:
    - pwa:build:production

pwa:deploy:live:
  stage: deploy-live
  tags:
    - script
  extends: .hosting:clone:live
  needs:
    - job: pwa:deploy
      artifacts: false
